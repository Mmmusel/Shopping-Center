"use strict";(self["webpackChunkmy_project"]=self["webpackChunkmy_project"]||[]).push([[561],{3998:function(t,s,i){i.r(s),i.d(s,{default:function(){return n}});var o=function(){var t=this,s=t._self._c;return s("div",{staticClass:"cart"},[t._m(0),s("div",{staticClass:"cart-content"},[t._l(t.userCartList,(function(i,o){return s("div",{key:i.index,staticClass:"cart-content-main"},[s("div",{staticClass:"cart-info"},[s("img",{attrs:{src:`http://127.0.0.1:8000/media/${t.productDictList[i.fields.product_id].fields.product_image}`,alt:"",height:"150px",width:"150px"}}),s("span",[t._v(t._s(t.productDictList[i.fields.product_id].fields.product_name))])]),s("div",{staticClass:"cart-price"},[t._v(" ￥ "+t._s(t.productDictList[i.fields.product_id].fields.product_cost)+" ")]),s("div",{staticClass:"cart-count"},[s("span",{staticClass:"cart-control-minus",on:{click:function(s){return t.handleCount(o,-1)}}},[t._v("-")]),t._v(" "+t._s(i.fields.num)+" "),s("span",{staticClass:"cart-control-add",on:{click:function(s){return t.handleCount(o,1)}}},[t._v("+")])]),s("div",{staticClass:"cart-cost"},[t._v(" ￥ "+t._s(t.productDictList[i.fields.product_id].fields.product_cost*(i.fields.num-0))+" ")]),s("div",{staticClass:"cart-delete"},[s("span",{staticClass:"cart-control-delete",on:{click:function(s){return t.handleDelete(o)}}},[t._v("删除")])])])})),t.userCartList.length?t._e():s("div",{staticClass:"cart-empty"},[t._v("购物车为空")])],2),s("div",{directives:[{name:"show",rawName:"v-show",value:t.userCartList.length,expression:"userCartList.length"}],staticClass:"cart-promotion"},[s("span",[t._v("使用优惠券")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.promotionCode,expression:"promotionCode"}],attrs:{type:"text"},domProps:{value:t.promotionCode},on:{input:function(s){s.target.composing||(t.promotionCode=s.target.value)}}}),s("span",{staticClass:"cart-control-promotion",on:{click:t.handleCheckCode}},[t._v("验证")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.userCartList.length,expression:"userCartList.length"}],staticClass:"cart-footer"},[s("div",{staticClass:"cart-footer-desc"},[t._v(" 共计 "),s("span",[t._v(t._s(t.countAll))])]),s("div",{staticClass:"cart-footer-desc"},[t._v(" 应付总额 "),s("span",[t._v(t._s(t.costAll-t.promotion))]),s("br"),t.promotion?[t._v(" (优惠"),s("span",[t._v("￥ "+t._s(t.promotion)+" ")]),t._v(") ")]:t._e()],2),s("div",{staticClass:"cart-footer-desc"},[s("div",{staticClass:"cart-control-order",on:{click:t.handleOrder}},[t._v("现在结算")])])])])},e=[function(){var t=this,s=t._self._c;return s("div",{staticClass:"cart-header"},[s("div",{staticClass:"cart-header-title"},[t._v("购物清单")]),s("div",{staticClass:"cart-header-main"},[s("div",{staticClass:"cart-info"},[t._v("商品信息")]),s("div",{staticClass:"cart-price"},[t._v("单价")]),s("div",{staticClass:"cart-count"},[t._v("数量")]),s("div",{staticClass:"cart-cost"},[t._v("小计")]),s("div",{staticClass:"cart-delete"},[t._v("删除")])])])}],a={name:"customer_cart",data(){return{promotion:0,promotionCode:"",userCartList:[],cartProductList:[],productList:[],productDictList:[]}},computed:{countAll(){let t=0;return this.userCartList.forEach((s=>{t+=s.fields.num})),t},costAll(){let t=0;return this.userCartList.forEach((s=>{t+=this.productDictList[s.fields.product_id].fields.product_cost*(s.fields.num-0),console.log(this.productDictList[s.fields.product_id].fields.product_cost*(s.fields.num-0)),console.log(s.fields.num-0),console.log(this.productDictList[s.fields.product_id].fields.product_cost)})),t}},methods:{async handleOrder(){console.log("thisthis"),await this.axios.get("add_order/",{params:{user_id:this.$store.state.userId}}).then((t=>{console.log(t)})).catch((function(t){console.log(t)})),console.log("this end");for(var t=this.userCartList.length;t>0;t--)await this.handleDelete(0);window.alert("购买成功")},handleCheckCode(){""!==this.promotionCode?"ccylovehs"===this.promotionCode?this.promotion=500:window.alert("优惠码输入错误"):window.alert("请输入优惠码")},async handleCount(t,s){await this.axios.get("edit_num_in_cart/",{params:{user_id:this.$store.state.userId,product_id:this.userCartList[t].fields.product_id,num:s}}).then((t=>{console.log("!!!!!!!!!!!!!!!!!----------"),console.log(t),console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!")})).catch((function(t){console.log(t)})),await this.cartList(this.$store.state.userId)},async handleDelete(t){await this.axios.get("delete_item_in_cart/",{params:{user_id:this.$store.state.userId,product_id:this.userCartList[t].fields.product_id}}).then((t=>{console.log(t)})).catch((function(t){console.log(t)})),await this.cartList(this.$store.state.userId)},async cartList(t){await this.axios.get("show_cart/",{params:{user_id:t}}).then((t=>{console.log(t),this.userCartList=t.data.list})).catch((function(t){console.log(t)})),await this.cartProductsList(this.$store.state.userId),this.productDictList={},await this.cartProductList.forEach((t=>{this.productDictList[t.pk]=t}))},async cartProductsList(t){await this.axios.get("cartProductsList/",{params:{user_id:t}}).then((t=>{console.log(t),this.cartProductList=t.data.list})).catch((function(t){console.log(t)}))}},async created(){console.log("cart-create"),console.log(this.$store.state.userId),await this.cartList(this.$store.state.userId),console.log("cart-create-success"),await this.cartProductsList(this.$store.state.userId),console.log(this.productDictList),console.log(this.productDictList[2].fields.product_cost)}},c=a,r=i(1001),d=(0,r.Z)(c,o,e,!1,null,"7de73fe6",null),n=d.exports}}]);
//# sourceMappingURL=561.444360dc.js.map